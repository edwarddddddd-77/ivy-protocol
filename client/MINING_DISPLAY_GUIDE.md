# 🎯 挖矿数据显示优化指南

## 📊 当前配置总览

我已经为你的前端实现了**智能刷新频率系统**，根据设备类型和网络状况自动优化数据刷新。

---

## ✅ 已完成的优化

### 1. **创建配置文件**
- **位置**: `src/config/refreshIntervals.ts`
- **功能**: 集中管理所有数据的刷新频率

### 2. **更新 useIvyContract Hook**
- **位置**: `src/hooks/useIvyContract.ts`
- **改进**: 所有数据查询都使用智能刷新频率

---

## 🔧 刷新频率配置详情

### **挖矿奖励 (pendingIvy)** - 最重要的实时数据

| 场景 | 刷新频率 | 说明 |
|------|---------|------|
| **桌面端（推荐）** | **10秒** | 体验流畅，数字平滑跳动 |
| 移动端 WiFi | 10秒 | 与桌面端相同 |
| 移动端 4G | 30秒 | 节省流量 |
| 移动端慢速网络 | 60秒 | 极致省电 |

> **为什么从 3 秒改为 10 秒？**
> - 3 秒刷新太频繁，用户看不清数字
> - 10 秒刷新体验更好，数字跳动更有节奏感
> - 节省服务器资源和用户流量

### **其他数据刷新频率**

| 数据类型 | 桌面端 | 移动端 | 变化频率 |
|---------|--------|--------|---------|
| 协议统计 (PID, 每日发行量) | 5秒 | 15秒 | 中等 |
| 用户余额 | 2秒 | 5秒 | 高 |
| 挖矿统计 (算力) | 5秒 | 10秒 | 低 |
| 锁仓信息 | 5秒 | 10秒 | 低 |
| Genesis Node 总数 | 10秒 | 30秒 | 很低 |

---

## 🎨 用户体验效果

### **桌面端（推荐配置）**
```
pendingIvy 每 10 秒更新一次：
00:00 → 0.347 IVY
00:10 → 0.694 IVY  (+0.347)
00:20 → 1.041 IVY  (+0.347)
00:30 → 1.388 IVY  (+0.347)

用户体验：数字稳定跳动，节奏感强 ✅
```

### **移动端 4G**
```
pendingIvy 每 30 秒更新一次：
00:00 → 0.347 IVY
00:30 → 1.388 IVY  (+1.041)
01:00 → 2.430 IVY  (+1.042)

用户体验：跳动较慢，但省流量 ✅
```

---

## 📱 设备自动识别

系统会自动检测：

1. **设备类型**
   - 桌面端: Chrome, Firefox, Edge, Safari (Mac)
   - 移动端: iOS, Android, iPad

2. **网络类型** (移动端)
   - WiFi: 使用较快刷新
   - 4G: 中等刷新频率
   - 3G/2G: 使用慢速刷新

3. **自动调整**
   - 移动端切换到 WiFi 时，自动提速
   - 桌面端始终使用最佳配置

---

## 🚀 如何使用

### **前端已自动应用**

所有页面的挖矿数据显示已自动使用智能刷新频率，无需额外配置。

### **如果想手动调整**

编辑 `src/config/refreshIntervals.ts`：

```typescript
export const REFRESH_INTERVALS = {
  PENDING_IVY: {
    DESKTOP_NORMAL: 10000,   // 改为 5000 = 5秒刷新
    MOBILE_4G: 30000,        // 改为 15000 = 15秒刷新
  },
};
```

---

## 🎯 未来扩展（可选）

### **用户自定义显示模式**

在配置文件中已经预留了 3 种模式，可以在设置页面让用户选择：

```typescript
// 已经定义好的 3 种模式：
'realtime'    → 实时模式（最快，3秒）
'balanced'    → 平衡模式（推荐，10秒）
'power-save'  → 省电模式（最慢，20秒）
```

**实现方式**（如果需要）：

1. 在设置页面添加切换开关
2. 保存用户选择到 localStorage
3. Hook 读取用户偏好，调用 `getRefreshIntervalByMode()`

示例代码：
```typescript
// 在 useIvyContract.ts 中
const userMode = localStorage.getItem('displayMode') || 'balanced';
const interval = getRefreshIntervalByMode('PENDING_IVY', userMode);
```

---

## 📊 性能对比

### **优化前（固定 3 秒）**
```
- 每分钟请求次数: 20次
- 每小时请求次数: 1200次
- 移动端流量消耗: 高
```

### **优化后（智能 10 秒/30 秒）**
```
桌面端:
- 每分钟请求次数: 6次
- 每小时请求次数: 360次
- 性能提升: 70% ⬇️

移动端 4G:
- 每分钟请求次数: 2次
- 每小时请求次数: 120次
- 性能提升: 90% ⬇️
```

---

## 🔍 技术细节

### **智能刷新的实现原理**

```typescript
// 1. 检测设备
const isMobile = isMobileDevice();

// 2. 检测网络（仅移动端）
const connectionType = getConnectionType(); // '4g' | '3g' | 'wifi'

// 3. 选择最佳刷新频率
if (isMobile && connectionType === '3g') {
  return 60000; // 慢速网络，60秒
} else if (isMobile && connectionType === '4g') {
  return 30000; // 4G，30秒
} else {
  return 10000; // 桌面端或WiFi，10秒
}
```

### **为什么不用 WebSocket？**

考虑过使用 WebSocket 实时推送，但：
- ❌ 需要额外的后端服务器
- ❌ 增加服务器成本
- ❌ 移动端保持长连接耗电
- ✅ 轮询查询更简单，成本低

当前的 10 秒轮询已经足够实时，体验很好。

---

## 💡 推荐配置总结

| 设备 | 挖矿奖励 | 其他数据 | 体验 |
|------|---------|---------|------|
| **桌面端** | **10秒** | 2-10秒 | 流畅 ⭐⭐⭐⭐⭐ |
| **移动端 WiFi** | **10秒** | 5-30秒 | 流畅 ⭐⭐⭐⭐⭐ |
| **移动端 4G** | **30秒** | 5-30秒 | 省电 ⭐⭐⭐⭐ |
| **移动端 3G** | **60秒** | 10-30秒 | 超省电 ⭐⭐⭐ |

---

## ✅ 验证方式

### **1. 打开浏览器控制台**
```javascript
// 查看当前刷新频率
import { getSmartRefreshInterval } from '@/config/refreshIntervals';
console.log('pendingIvy 刷新频率:', getSmartRefreshInterval('PENDING_IVY'), 'ms');
```

### **2. 观察网络请求**
- 打开 DevTools → Network 标签
- 筛选 `pendingIvy` 请求
- 查看请求间隔时间

### **3. 移动端测试**
- 使用 Chrome DevTools 模拟移动设备
- 打开 Network 标签 → Throttling → Slow 3G
- 观察刷新频率是否自动调整到 60 秒

---

## 🎉 总结

**已完成的优化：**
✅ 智能检测设备类型（桌面/移动）
✅ 智能检测网络状况（WiFi/4G/3G）
✅ 自动调整刷新频率
✅ 所有数据分级优化（重要的快，不重要的慢）
✅ 性能提升 70-90%
✅ 保持用户体验流畅

**推荐设置：**
- 桌面端：10 秒刷新 pendingIvy ⭐
- 移动端：30-60 秒（根据网络）⭐

**无需额外配置，立即生效！** 🚀
