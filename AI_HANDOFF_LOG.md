# AI Agent Handoff Log: Ivy Protocol

**Timestamp:** 2026-01-03
**From Agent:** Manus AI (Session Ending)
**To Agent:** Next Manus AI Instance (Session Beginning)

---

## 1. Current System State & Architecture

The project has been refactored to a **Dual-Track Parallel Architecture**. All development must adhere to this separation of concerns.

### Track A: Identity & Access Layer (`GenesisNode.sol`)
-   **Contract**: `GenesisNode.sol`
-   **Type**: ERC721 NFT
-   **Business Logic**: Represents a user's **identity and status** within the protocol. It is a one-time purchase that grants permanent privileges.
-   **Total Supply**: **1,386** (Hard-coded `MAX_SUPPLY`).
-   **Price**: **1,000 USDT** (Hard-coded `NODE_PRICE`).
-   **Fund Flow**: **100%** of the sale proceeds are transferred directly to the `TeamOpsWallet`. **There is no other fund splitting in this track.**
-   **Core Attributes**:
    -   `selfBoost`: **+10%** mining power for the holder.
    -   `teamAura`: **+2%** mining power bonus for the holder's direct referrals.
-   **Referral**: The contract records the `referrer` relationship upon minting.

### Track B: Treasury & Yield Layer (`IvyBond.sol` + `IvyCore.sol`)
-   **Contracts**: `IvyBond.sol` (entry point), `IvyCore.sol` (engine).
-   **Business Logic**: Manages user capital investment and yield generation. This is where the core DeFi mechanics reside.
-   **Fund Entry**: Users deposit USDT via the `deposit(uint256 amount)` function in `IvyBond.sol`.
-   **Fund Splitting (The 50/40/10 Split)**: All capital from `deposit` is split as follows:
    -   **50%** -> `LiquidityPool`
    -   **40%** -> `RWAWallet`
    -   **10%** -> `ReservePool`
-   **Referral Yield**:
    -   Yield is generated by `IvyCore.sol` through its mining/minting functions.
    -   When a user claims their yield, `IvyCore` reads the referral relationship from `GenesisNode`.
    -   **Additional IVY tokens** are minted from the mining pool and distributed to uplines based on the defined commission structure (L1 10%, L2 5%, etc.).
    -   **Crucially, referral rewards are new emissions, not deductions from the user's principal or yield.**

## 2. Frontend UI Status

The frontend has been upgraded from a single-page dashboard to a **Multi-Page Application** to reflect the dual-track architecture.

-   **/nodes (Node Console)**: Dedicated page for Track A. Contains the `IdentityPanel` for purchasing NFTs and the `MyNodes` & `ReferralCenter` components for viewing assets and network status.
-   **/yield (Yield Terminal)**: Dedicated page for Track B. Contains the `TreasuryPanel` for depositing capital and viewing investment-related data.
-   **Full i18n Support**: The entire application, including all new pages and components, now supports English (`en`) and Traditional Chinese (`zh`) via the `LanguageContext`.
-   **Faucet UI**: The testnet faucet has been moved from the main page into a Modal window, triggered by a persistent yellow button in the Navbar to prevent UI clutter.

## 3. Known Bugs & Immediate Next Steps

**CRITICAL BUG:** The testnet user flow is currently blocked.

-   **Root Cause**: The `client/src/contracts/addresses.json` file is missing the deployed contract addresses for `MockUSDT` and `IvyBond`.
-   **Symptom**: The Faucet button, while visible, will show a "Contract Not Deployed" error when clicked, preventing users from getting test tokens. Consequently, no minting or depositing can be tested.

**ACTION REQUIRED FOR NEXT AGENT:**

1.  **Deploy Contracts**: Run the project's deployment scripts (e.g., using Hardhat or Foundry) on the BSC testnet.
2.  **Update Addresses**: After deployment, copy the new contract addresses for `MockUSDT` and `IvyBond` into the `client/src/contracts/addresses.json` file.
3.  **Test Flow**: Once the addresses are updated, the full end-to-end test path will be unblocked:
    -   Click Faucet -> Get 20,000 mUSDT.
    -   Go to `/nodes` -> Approve & Buy Genesis Node (1,000 USDT).
    -   Go to `/yield` -> Approve & Deposit USDT.

This concludes the handoff. The repository is in a logically sound state, pending the contract deployment and address update.
